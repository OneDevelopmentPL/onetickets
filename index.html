<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OneTickets – Skaner</title>
    <script src="https://unpkg.com/html5-qrcode" defer></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #reader { width: 300px; margin: 20px auto; }
        #popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 22px;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>
    <h1>OneTickets – Skaner biletów</h1>
    <p>Skanuj bilety, aby potwierdzić użytkownika.</p>

    <div id="reader" style="width:350px; height:350px; border:2px solid #000; border-radius:12px;"></div>
    <div id="popup"></div>

    <script>
        // Ten skaner działa TYLKO pod adresem:
        // https://onedevelopmentpl.github.io/onetickets

        function showPopup(text) {
            const popup = document.getElementById("popup");
            popup.textContent = text;
            popup.style.display = "block";
            setTimeout(() => {
                popup.style.display = "none";
            }, 3000);
        }

        function onScanSuccess(qrMessage) {
            // Oczekiwany format:  https://onedevelopmentpl.github.io/tickets/t?=Imie,Nazwisko
            if (!qrMessage.startsWith("https://onedevelopmentpl.github.io/tickets/t?=")) {
                showPopup("Błędny format QR!");
                return;
            }

            const data = qrMessage.split("?=");
            if (data.length !== 2) {
                showPopup("Niepoprawne dane QR!");
                return;
            }

            const osoba = decodeURIComponent(data[1]);
            if (!osoba.includes(",")) {
                showPopup("Brak imienia i nazwiska!");
                return;
            }

            const [imie, nazwisko] = osoba.split(",");
            showPopup(`${imie} ${nazwisko}`);
        }

        function onScanError(err) {
            alert("Wystąpił nieoczekiwany błąd!");
        }

        const html5QrCode = new Html5Qrcode("reader");
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(() => {
                Html5Qrcode.getCameras().then(cameras => {
            if (cameras && cameras.length) {
                html5QrCode.start(
                    cameras[0].id,
                    { fps: 10, qrbox: 250 },
                    onScanSuccess,
                    onScanError
                );
            }
        });
    </script>
</body>
</html>
